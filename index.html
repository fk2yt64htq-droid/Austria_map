<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Austria Map</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"/>
<style>
html, body { margin:0; padding:0; height:100%; }
#map { height:100vh; width:100vw; }
.btn { width: 100%; padding:6px; margin-top:5px; color:white; border:none; border-radius:5px; font-weight:bold; cursor:pointer; }
.leaflet-popup-content-wrapper { border-radius:8px; }
</style>
</head>
<body>
<div id="map"></div>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const API_URL = "https://austria-map.onrender.com"; // <-- –≤—Å—Ç–∞–≤ —Å–≤—ñ–π —Å–µ—Ä–≤–µ—Ä

const dots = [
  {id:1,n:"H√∂rbranz A14",lat:47.5446,lon:9.7407},
  {id:2,n:"Nuziders A14",lat:47.1731,lon:9.7737},
  {id:3,n:"Rabfeld A12",lat:47.4574,lon:11.9196},
  {id:4,n:"Kundl A12",lat:47.4734,lon:11.9693},
  {id:5,n:"Wels A8",lat:48.1790,lon:13.8623},
  {id:6,n:"Wolfsbach A1 (1)",lat:48.1120,lon:14.6761},
  {id:7,n:"Wolfsbach A1 (2)",lat:48.1123,lon:14.6786},
  {id:8,n:"Mistelbach A5",lat:48.5389,lon:16.6259},
  {id:9,n:"Bruck an der Leitha A4",lat:48.0431,lon:16.7791},
  {id:10,n:"Pernau A2",lat:47.0900,lon:15.8511},
  {id:11,n:"Strass in Steiermark A9",lat:46.7317,lon:15.6436},
  {id:12,n:"Hainburg A2",lat:46.6845,lon:14.6591},
  {id:13,n:"Arnoldstein A2",lat:46.5492,lon:13.7042}
];

const map = L.map('map').setView([47.5162,14.5501],7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

const markers = {};

async function loadStats(){
    try{
        const response = await fetch(API_URL + "/stats");
        const stats = await response.json();
        dots.forEach(p=>{
            const s = stats[p.id] || {green:0, red:0};
            const total = s.green + s.red;
            const rPerc = total>0? Math.round(s.red/total*100):0;
            let color = total===0? "blue": (rPerc>=50? "red":"green");

            if(!markers[p.id]){
                markers[p.id] = L.marker([p.lat,p.lon]).addTo(map);
                L.circle([p.lat,p.lon], {radius:1500, color:'blue', weight:1, fillOpacity:0.1}).addTo(map);
            }
            markers[p.id].setPopupContent(`
                <b>${p.n}</b><br>
                üî¥ ${rPerc}% | üü¢ ${100-rPerc}%<br>
                <button class="btn" style="background:green" onclick="sendVote(${p.id}, 'green')">–ß–ò–°–¢–û</button>
                <button class="btn" style="background:red" onclick="sendVote(${p.id}, 'red')">–ö–û–ù–¢–†–û–õ–¨</button>
            `);
        });
    }catch(e){console.error(e);}
}

window.sendVote = async(id,status)=>{
    try{
        await fetch(API_URL+"/update",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({id,status})
        });
        loadStats();
    }catch(e){alert("–°–µ—Ä–≤–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î");}
};

loadStats();
setInterval(loadStats,10000);
</script>
</body>
</html>
